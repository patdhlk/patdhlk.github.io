(function(a){a.fn.gMap=function(b,d){switch(b){case"addMarker":return a(this).trigger("gMap.addMarker",[d.latitude,d.longitude,d.content,d.icon,d.popup]);case"centerAt":return a(this).trigger("gMap.centerAt",[d.latitude,d.longitude,d.zoom])}var c=a.extend({},a.fn.gMap.defaults,b);return this.each(function(){var g=new google.maps.Map(this);var i=new google.maps.Geocoder();if(c.address){i.geocode({address:c.address},function(m,j){if(m&&m.length){g.setCenter(m[0].geometry.location)}})}else{if(c.latitude&&c.longitude){g.setCenter(new google.maps.LatLng(c.latitude,c.longitude))}else{if(a.isArray(c.markers)&&c.markers.length>0){if(c.markers[0].address){i.geocode({address:c.markers[0].address},function(m,j){if(m&&m.length>0){g.setCenter(m[0].geometry.location)}})}else{g.setCenter(new google.maps.LatLng(c.markers[0].latitude,c.markers[0].longitude))}}else{g.setCenter(new google.maps.LatLng(34.885931,9.84375))}}}g.setZoom(c.zoom);g.setMapTypeId(google.maps.MapTypeId[c.maptype]);var f={scrollwheel:c.scrollwheel,disableDoubleClickZoom:!c.doubleclickzoom};if(c.controls===false){a.extend(f,{disableDefaultUI:true})}else{if(c.controls.length!=0){a.extend(f,c.controls,{disableDefaultUI:true})}}g.setOptions(f);var k=new google.maps.Marker();marker_icon=new google.maps.MarkerImage(c.icon.image);marker_icon.size=new google.maps.Size(c.icon.iconsize[0],c.icon.iconsize[1]);marker_icon.anchor=new google.maps.Point(c.icon.iconanchor[0],c.icon.iconanchor[1]);k.setIcon(marker_icon);if(c.icon.shadow){marker_shadow=new google.maps.MarkerImage(c.icon.shadow);marker_shadow.size=new google.maps.Size(c.icon.shadowsize[0],c.icon.shadowsize[1]);marker_shadow.anchor=new google.maps.Point(c.icon.shadowanchor[0],c.icon.shadowanchor[1]);k.setShadow(marker_shadow)}a(this).bind("gMap.centerAt",function(n,o,m,j){if(j){g.setZoom(j)}g.panTo(new google.maps.LatLng(parseFloat(o),parseFloat(m)))});var h;a(this).bind("gMap.addMarker",function(q,s,j,r,t,m){var n=new google.maps.LatLng(parseFloat(s),parseFloat(j));var p=new google.maps.Marker({position:n});if(t){marker_icon=new google.maps.MarkerImage(t.image);marker_icon.size=new google.maps.Size(t.iconsize[0],t.iconsize[1]);marker_icon.anchor=new google.maps.Point(t.iconanchor[0],t.iconanchor[1]);p.setIcon(marker_icon);if(t.shadow){marker_shadow=new google.maps.MarkerImage(t.shadow);marker_shadow.size=new google.maps.Size(t.shadowsize[0],t.shadowsize[1]);marker_shadow.anchor=new google.maps.Point(t.shadowanchor[0],t.shadowanchor[1]);k.setShadow(marker_shadow)}}else{p.setIcon(k.getIcon());p.setShadow(k.getShadow())}if(r){if(r=="_latlng"){r=s+", "+j}var o=new google.maps.InfoWindow({content:c.html_prepend+r+c.html_append});google.maps.event.addListener(p,"click",function(){h&&h.close();o.open(g,p);h=o});if(m){google.maps.event.addListenerOnce(g,"tilesloaded",function(){o.open(g,p)})}}p.setMap(g)});for(var e=0;e<c.markers.length;e++){marker=c.markers[e];if(marker.address){if(marker.html=="_address"){marker.html=marker.address}var l=this;i.geocode({address:marker.address},(function(j,m){return function(o,n){if(o&&o.length>0){a(m).trigger("gMap.addMarker",[o[0].geometry.location.lat(),o[0].geometry.location.lng(),j.html,j.icon,j.popup])}}})(marker,l))}else{a(this).trigger("gMap.addMarker",[marker.latitude,marker.longitude,marker.html,marker.icon,marker.popup])}}})};a.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:false,doubleclickzoom:true,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}})(jQuery);