(function(i,j,g,h){var f=function(a,b){this.elem=a;this.$elem=i(a);this.options=b;this.metadata=this.$elem.data("plugin-options");this.$nav=this.$elem.find("a");this.$win=i(j);this.sections={};this.didScroll=false;this.$doc=i(g);this.docHeight=this.$doc.height()};f.prototype={defaults:{currentClass:"current",changeHash:false,easing:"swing",filter:"",scrollSpeed:200,scrollOffset:0,scrollThreshold:0.5,begin:false,end:false,scrollChange:false},init:function(){var a=this;a.config=i.extend({},a.defaults,a.options,a.metadata);if(a.config.filter!==""){a.$nav=a.$nav.filter(a.config.filter)}a.$nav.on("click.onePageNav",i.proxy(a.handleClick,a));a.getPositions();a.bindInterval();a.$win.on("resize.onePageNav",i.proxy(a.getPositions,a));return this},adjustNav:function(b,a){b.$elem.find("."+b.config.currentClass).removeClass(b.config.currentClass);a.addClass(b.config.currentClass)},bindInterval:function(){var a=this;var b;a.$win.on("scroll.onePageNav",function(){a.didScroll=true});a.t=setInterval(function(){b=a.$doc.height();if(a.didScroll){a.didScroll=false;a.scrollChange()}if(b!==a.docHeight){a.docHeight=b;a.getPositions()}},250)},getHash:function(a){return a.attr("href").split("#")[1]},getPositions:function(){var b=this;var a;var c;var d;b.$nav.each(function(){a=b.getHash(i(this));d=i("#"+a);if(d.length){c=d.offset().top;b.sections[a]=Math.round(c)-b.config.scrollOffset}})},getSection:function(a){var d=null;var b=Math.round(this.$win.height()*this.config.scrollThreshold);for(var c in this.sections){if((this.sections[c]-b)<a){d=c}}return d},handleClick:function(a){var d=this;var e=i(a.currentTarget);var b=e.parent();var c="#"+d.getHash(e);if(!b.hasClass(d.config.currentClass)){if(d.config.begin){d.config.begin()}d.adjustNav(d,b);d.unbindInterval();i.scrollTo(c,d.config.scrollSpeed,{axis:"y",easing:d.config.easing,offset:{top:-d.config.scrollOffset},onAfter:function(){if(d.config.changeHash){j.location.hash=c}d.bindInterval();if(d.config.end){d.config.end()}}})}a.preventDefault()},scrollChange:function(){var a=this.$win.scrollTop();var c=this.getSection(a);var b;if(c!==null){b=this.$elem.find('a[href$="#'+c+'"]').parent();if(!b.hasClass(this.config.currentClass)){this.adjustNav(this,b);if(this.config.scrollChange){this.config.scrollChange(b)}}}},unbindInterval:function(){clearInterval(this.t);this.$win.unbind("scroll.onePageNav")}};f.defaults=f.prototype.defaults;i.fn.onePageNav=function(a){return this.each(function(){new f(this,a).init()})}})(jQuery,window,document);